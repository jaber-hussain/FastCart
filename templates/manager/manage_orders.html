{% extends 'partials/base.html' %}
{% load static %}
{% load humanize %}
{% block content %}
<section class="middle">
  <div class="container-fluid">
    <div class="row align-items-start justify-content-between">

      <!-- Sidebar -->
      {% include 'manager/sidebar.html' %}

      <!-- Main Content (Orders) -->
      <div class="col-12 col-md-12 col-lg-8 col-xl-9">
        <h4 class="mb-0 mb-4 fw-bold">Orders ({{ orders|length }})</h4>

        {% for order in orders %}
          <div class="ord_list_wrap border mb-4 mfliud">
            <!-- Header -->
            <div class="ord_list_head bg-light bg-opacity-10 d-flex align-items-center justify-content-between px-3 py-3">
              <div class="olh_flex">
                <h6 class="mb-0 ft-medium">Order #{{ order.id }} - {{ order.customer_name|default:"Guest" }}</h6>
                <small class="text-muted">{{ order.customer_email }}</small>
              </div>
              <div class="olh_flex">
                <a href="{% url 'manager:view_order' order.id %}" class="btn btn-sm bg-primary rounded text-white me-1">
                  View
                </a>
                <a href="{% url 'manager:edit_order' order.id %}" class="btn btn-sm bg-warning rounded text-white me-1">
                  Edit
                </a>
                <form method="POST" action="{% url 'manager:delete_order' order.id %}" class="d-inline">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm bg-danger rounded text-white"
                    onclick="return confirm('Are you sure you want to delete this order?');">
                    Delete
                  </button>
                </form>
              </div>
            </div>

            <!-- Body -->
            <div class="ord_list_body text-left">
              <div class="row align-items-center justify-content-center m-0 py-4 br-bottom">
                <div class="col-xl-6 col-lg-5 col-md-5 col-12">
                  <div class="cart_single d-flex align-items-start mfliud-bot gap-3">
                    <div class="cart_selected_single_thumb">
                      <img src="{{ order.thumbnail.url|default:'/static/images/default_order.png' }}" 
                           width="75" class="img-fluid rounded" alt="Order Thumbnail" />
                    </div>
                    <div class="cart_single_caption pl-3">
                      <p class="mb-1">
                        <span class="text-dark medium">Total:</span>
                        <span class="fw-bold">${{ order.total|floatformat:2 }}</span>
                      </p>
                      <p class="mb-1">
                        <span class="text-dark medium">Status:</span>
                        <span class="badge 
                          {% if order.status == 'Pending' %}bg-warning text-dark
                          {% elif order.status == 'Shipped' %}bg-info text-dark
                          {% elif order.status == 'Delivered' %}bg-success
                          {% else %}bg-secondary{% endif %}">
                          {{ order.status }}
                        </span>
                      </p>
                      <p class="mb-0">
                        <span class="text-dark medium">Payment:</span>
                        <span class="badge 
                          {% if order.payment_status == 'Paid' %}bg-success
                          {% elif order.payment_status == 'Failed' %}bg-danger
                          {% else %}bg-secondary{% endif %}">
                          {{ order.payment_status }}
                        </span>
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-xl-2 col-lg-3 col-md-3 col-6">
                  <p class="mb-1 p-0"><span class="text-muted">Items</span></p>
                  <h6 class="mb-0 ft-medium fs-sm">{{ order.items_count }}</h6>
                </div>
                <div class="col-xl-2 col-lg-4 col-md-4 col-6">
                  <p class="mb-1 p-0"><span class="text-muted">Placed On</span></p>
                  <h6 class="mb-0 ft-medium fs-sm">{{ order.date|date:"M d, Y" }}</h6>
                </div>
              </div>
            </div>

            <!-- Footer -->
            <div class="ord_list_footer d-flex align-items-center justify-content-between br-top px-3">
              <div class="col-xl-12 pr-0 py-2 olf_flex d-flex align-items-center justify-content-between">
                <div class="olf_flex_inner hide_mob">
                  <p class="m-0 p-0">
                    <span class="text-muted medium">Total: </span>
                    <span class="fw-bold">${{ order.total|floatformat:2 }}</span>
                  </p>
                </div>
              </div>
            </div>
          </div>
        {% empty %}
          <p>No orders found</p>
        {% endfor %}

        <!-- Pagination -->
        {% if orders.has_other_pages %}
          <ul class="pagination">
            {% if orders.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{ orders.previous_page_number }}">Previous</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Previous</span></li>
            {% endif %}

            {% for num in orders.paginator.page_range %}
              <li class="page-item {% if orders.number == num %}active{% endif %}">
                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
              </li>
            {% endfor %}

            {% if orders.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ orders.next_page_number }}">Next</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Next</span></li>
            {% endif %}
          </ul>
        {% endif %}
      </div> <!-- End Main Content -->
    </div>
  </div>
</section>
{% endblock content %}
